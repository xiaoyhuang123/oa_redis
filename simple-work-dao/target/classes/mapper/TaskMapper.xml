<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ft.backend.work.dao.TaskMapper">
  <resultMap id="BaseResultMap" type="com.ft.backend.work.model.Task">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="work_type" jdbcType="VARCHAR" property="workType" />
    <result column="leader_id" jdbcType="BIGINT" property="leaderId" />
    <result column="leader_name" jdbcType="VARCHAR" property="leaderName" />
    <result column="chejian_id" jdbcType="BIGINT" property="chejianId" />
    <result column="chejian_name" jdbcType="VARCHAR" property="chejianName" />
    <result column="chedui_id" jdbcType="BIGINT" property="cheduiId" />
    <result column="chedui_name" jdbcType="VARCHAR" property="cheduiName" />
    <result column="worker_id" jdbcType="BIGINT" property="workerId" />
    <result column="worker_name" jdbcType="VARCHAR" property="workerName" />
    <result column="role_type" jdbcType="BIT" property="roleType" />
    <result column="start_time" jdbcType="TIMESTAMP" property="startTime" />
    <result column="end_time" jdbcType="TIMESTAMP" property="endTime" />
    <result column="summary" jdbcType="VARCHAR" property="summary" />
    <result column="details" jdbcType="VARCHAR" property="details" />
    <result column="file_url" jdbcType="VARCHAR" property="fileUrl" />
    <result column="feedback" jdbcType="BIT" property="feedback" />
    <result column="feedback_type" jdbcType="VARCHAR" property="feedbackType" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="publisher" jdbcType="VARCHAR" property="publisher" />
    <result column="is_received" jdbcType="BIT" property="isReceived" />
    <result column="receive_time" jdbcType="TIMESTAMP" property="receiveTime" />
    <result column="is_completed" jdbcType="BIT" property="isCompleted" />
    <result column="complete_time" jdbcType="TIMESTAMP" property="completeTime" />
    <result column="feedback_content" jdbcType="VARCHAR" property="feedbackContent" />
    <result column="parent_id" jdbcType="BIGINT" property="parentId" />
    <result column="score" jdbcType="BIGINT" property="score" />
    <result column="score_result" jdbcType="VARCHAR" property="scoreResult" />
    <result column="score_username" jdbcType="VARCHAR" property="scoreUsername" />
    <result column="target_type" jdbcType="BIT" property="targetType" />
    <result column="is_deleted" jdbcType="BIT" property="isDeleted" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, work_type,leader_id,leader_name, chejian_id, chejian_name,chedui_id, chedui_name,worker_id, worker_name, role_type, start_time, end_time, summary, details,
    file_url, feedback,feedback_type, create_time, publisher, is_received,receive_time, is_completed,complete_time, feedback_content, score,score_result,score_username, parent_id,  is_deleted, target_type
  </sql>

  <sql id="Base_Column_List_WithOut_Id">
     work_type, leader_id,leader_name,chejian_id, chejian_name,chedui_id, chedui_name,worker_id, worker_name, role_type, start_time, end_time, summary, details,
    file_url, feedback, feedback_type, create_time, publisher, is_received,receive_time, is_completed,complete_time,
    feedback_content,score,score_result,score_username , parent_id, is_deleted, target_type
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from sys_task
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from sys_task
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" useGeneratedKeys="true" keyProperty="id" parameterType="com.ft.backend.work.model.Task">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into sys_task ( work_type, leader_id,leader_name,chejian_id, chejian_name,chedui_id, chedui_name,worker_id,
      worker_name, role_type, start_time, 
      end_time, summary, details, 
      file_url, feedback, feedback_type, create_time,
      publisher, is_received,receive_time, is_completed, complete_time,feedback_content
    score,score_result,score_username,
      parent_id, is_deleted, target_type)
    values ( #{workType,jdbcType=VARCHAR},
    #{leaderId,jdbcType=BIGINT},    #{leaderName,jdbcType=VARCHAR},
    #{chejianId,jdbcType=BIGINT},    #{chejianName,jdbcType=VARCHAR},
    #{cheduiId,jdbcType=BIGINT},    #{cheduiName,jdbcType=VARCHAR},
    #{workerId,jdbcType=BIGINT},
      #{workerName,jdbcType=VARCHAR}, #{roleType,jdbcType=BIT}, #{startTime,jdbcType=TIMESTAMP}, 
      #{endTime,jdbcType=TIMESTAMP}, #{summary,jdbcType=VARCHAR}, #{details,jdbcType=VARCHAR}, 
      #{fileUrl,jdbcType=VARCHAR}, #{feedback,jdbcType=BIT}, #{feedbackType,jdbcType=VARCHAR},
    #{createTime,jdbcType=TIMESTAMP},
      #{publisher,jdbcType=VARCHAR}, #{isReceived,jdbcType=BIT}, #{receiveTime,jdbcType=TIMESTAMP},
    #{isCompleted,jdbcType=BIT}, #{completeTime,jdbcType=TIMESTAMP},#{feedbackContent,jdbcType=VARCHAR},
    #{score,jdbcType=BIGINT},#{scoreResult,jdbcType=VARCHAR},#{scoreUsername,jdbcType=VARCHAR},
      #{parentId,jdbcType=BIGINT}, #{isDeleted,jdbcType=BIT}, #{targetType,jdbcType=BIT})
  </insert>
  <insert id="insertSelective" useGeneratedKeys="true" keyProperty="id" parameterType="com.ft.backend.work.model.Task">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into sys_task
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="workType != null">
        work_type,
      </if>
      <if test="leaderId != null">
        leader_id,
      </if>
      <if test="leaderName != null">
        leader_name,
      </if>
      <if test="chejianId != null">
        chejian_id,
      </if>
      <if test="chejianName != null">
        chejian_name,
      </if>
      <if test="cheduiId != null">
        chedui_id,
      </if>
      <if test="cheduiName != null">
        chedui_name,
      </if>
      <if test="workerId != null">
        worker_id,
      </if>
      <if test="workerName != null">
        worker_name,
      </if>
      <if test="roleType != null">
        role_type,
      </if>
      <if test="startTime != null">
        start_time,
      </if>
      <if test="endTime != null">
        end_time,
      </if>
      <if test="summary != null">
        summary,
      </if>
      <if test="details != null">
        details,
      </if>
      <if test="fileUrl != null">
        file_url,
      </if>
      <if test="feedback != null">
        feedback,
      </if>
      <if test="feedbackType != null">
        feedback_type,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="publisher != null">
        publisher,
      </if>
      <if test="isReceived != null">
        is_received,
      </if>
      <if test="receiveTime != null">
        receive_time,
      </if>
      <if test="isCompleted != null">
        is_completed,
      </if>
      <if test="completeTime != null">
        complete_time,
      </if>
      <if test="feedbackContent != null">
        feedback_content,
      </if>
      <if test="score != null">
        score,
      </if>
      <if test="scoreResult != null">
        score_result,
      </if>
      <if test="scoreUsername != null">
        score_username,
      </if>
      <if test="parentId != null">
        parent_id,
      </if>
      <if test="isDeleted != null">
        is_deleted,
      </if>
      <if test="targetType != null">
        target_type,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="workType != null">
        #{workType,jdbcType=VARCHAR},
      </if>
      <if test="leaderId != null">
        #{leaderId,jdbcType=BIGINT},
      </if>
      <if test="leaderName != null">
        #{leaderName,jdbcType=VARCHAR},
      </if>
      <if test="chejianId != null">
        #{chejianId,jdbcType=BIGINT},
      </if>
      <if test="chejianName != null">
        #{chejianName,jdbcType=VARCHAR},
      </if>
      <if test="cheduiId != null">
        #{cheduiId,jdbcType=BIGINT},
      </if>
      <if test="cheduiName != null">
        #{cheduiName,jdbcType=VARCHAR},
      </if>
      <if test="workerId != null">
        #{workerId,jdbcType=BIGINT},
      </if>
      <if test="workerName != null">
        #{workerName,jdbcType=VARCHAR},
      </if>
      <if test="roleType != null">
        #{roleType,jdbcType=BIT},
      </if>
      <if test="startTime != null">
        #{startTime,jdbcType=TIMESTAMP},
      </if>
      <if test="endTime != null">
        #{endTime,jdbcType=TIMESTAMP},
      </if>
      <if test="summary != null">
        #{summary,jdbcType=VARCHAR},
      </if>
      <if test="details != null">
        #{details,jdbcType=VARCHAR},
      </if>
      <if test="fileUrl != null">
        #{fileUrl,jdbcType=VARCHAR},
      </if>
      <if test="feedback != null">
        #{feedback,jdbcType=BIT},
      </if>
      <if test="feedbackType != null">
        #{feedbackType,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="publisher != null">
        #{publisher,jdbcType=VARCHAR},
      </if>
      <if test="isReceived != null">
        #{isReceived,jdbcType=BIT},
      </if>
      <if test="receiveTime != null">
        #{receiveTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isCompleted != null">
        #{isCompleted,jdbcType=BIT},
      </if>
      <if test="completeTime != null">
        #{completeTime,jdbcType=TIMESTAMP},
      </if>
      <if test="feedbackContent != null">
        #{feedbackContent,jdbcType=VARCHAR},
      </if>
      <if test="score != null">
        #{score,jdbcType=BIGINT},
      </if>
      <if test="scoreResult != null">
        #{scoreResult,jdbcType=VARCHAR},
      </if>
      <if test="scoreUsername != null">
        #{scoreUsername,jdbcType=VARCHAR},
      </if>
      <if test="parentId != null">
        #{parentId,jdbcType=BIGINT},
      </if>
      <if test="isDeleted != null">
        #{isDeleted,jdbcType=BIT},
      </if>
      <if test="targetType != null">
        #{targetType,jdbcType=BIT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.ft.backend.work.model.Task">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update sys_task
    <set>
      <if test="workType != null">
        work_type = #{workType,jdbcType=VARCHAR},
      </if>
      <if test="leaderId != null">
        leader_id = #{leaderId,jdbcType=BIGINT},
      </if>
      <if test="leaderName != null">
        leader_name = #{leaderName,jdbcType=VARCHAR},
      </if>
      <if test="chejianId != null">
        chejian_id = #{chejianId,jdbcType=BIGINT},
      </if>
      <if test="chejianName != null">
        chejian_name = #{chejainName,jdbcType=VARCHAR},
      </if>
      <if test="cheduiId != null">
        chedui_id = #{cheduiId,jdbcType=BIGINT},
      </if>
      <if test="cheduiName != null">
        chedui_name = #{cheduiName,jdbcType=VARCHAR},
      </if>
      <if test="workerId != null">
        worker_id = #{workerId,jdbcType=BIGINT},
      </if>
      <if test="workerName != null">
        worker_name = #{workerName,jdbcType=VARCHAR},
      </if>
      <if test="roleType != null">
        role_type = #{roleType,jdbcType=BIT},
      </if>
      <if test="startTime != null">
        start_time = #{startTime,jdbcType=TIMESTAMP},
      </if>
      <if test="endTime != null">
        end_time = #{endTime,jdbcType=TIMESTAMP},
      </if>
      <if test="summary != null">
        summary = #{summary,jdbcType=VARCHAR},
      </if>
      <if test="details != null">
        details = #{details,jdbcType=VARCHAR},
      </if>
      <if test="fileUrl != null">
        file_url = #{fileUrl,jdbcType=VARCHAR},
      </if>
      <if test="feedback != null">
        feedback = #{feedback,jdbcType=BIT},
      </if>
      <if test="feedbackType != null">
        feedback_type = #{feedbackType,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="publisher != null">
        publisher = #{publisher,jdbcType=VARCHAR},
      </if>
      <if test="isReceived != null">
        is_received = #{isReceived,jdbcType=BIT},
      </if>
      <if test="receiveTime != null">
        receive_time = #{receiveTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isCompleted != null">
        is_completed = #{isCompleted,jdbcType=BIT},
      </if>
      <if test="completeTime != null">
        complete_time = #{completeTime,jdbcType=TIMESTAMP},
      </if>
      <if test="feedbackContent != null">
        feedback_content = #{feedbackContent,jdbcType=VARCHAR},
      </if>
      <if test="score != null">
        score = #{score,jdbcType=BIGINT},
      </if>
      <if test="scoreResult != null">
        score_result = #{scoreResult,jdbcType=VARCHAR},
      </if>
      <if test="scoreUsername != null">
        score_username = #{scoreUsername,jdbcType=VARCHAR},
      </if>
      <if test="parentId != null">
        parent_id = #{parentId,jdbcType=BIGINT},
      </if>
      <if test="isDeleted != null">
        is_deleted = #{isDeleted,jdbcType=BIT},
      </if>
      <if test="targetType != null">
        target_type = #{targetType,jdbcType=BIT},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>

  <update id="updateByPrimaryKeySelectiveWithNull" parameterType="map">
    update sys_task
    <set>
      <if test="isCompleted != null">
        is_completed = #{isCompleted,jdbcType=BIT},
      </if>
      <if test="completeTime != null">
        complete_time = #{completeTime,jdbcType=TIMESTAMP},
      </if>
      <if test="1 != null">
        feedback_content = #{feedbackContent,jdbcType=VARCHAR},
      </if>
      <if test="1 != null">
        score = #{score,jdbcType=BIGINT},
      </if>
      <if test="1 != null">
        score_result = #{scoreResult,jdbcType=VARCHAR},
      </if>
      <if test="1 != null">
        score_username = #{scoreUsername,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>

  <update id="updateByPrimaryKey" parameterType="com.ft.backend.work.model.Task">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update sys_task
    set work_type = #{workType,jdbcType=VARCHAR},
    leader_id = #{leaderId,jdbcType=BIGINT},
    leader_name = #{leaderName,jdbcType=VARCHAR},
      chejian_id = #{chejianId,jdbcType=BIGINT},
      chejian_name = #{chejianName,jdbcType=VARCHAR},
      chedui_id = #{cheduiId,jdbcType=BIGINT},
      chedui_name = #{cheduiName,jdbcType=VARCHAR},
      worker_id = #{workerId,jdbcType=BIGINT},
      worker_name = #{workerName,jdbcType=VARCHAR},
      role_type = #{roleType,jdbcType=BIT},
      start_time = #{startTime,jdbcType=TIMESTAMP},
      end_time = #{endTime,jdbcType=TIMESTAMP},
      summary = #{summary,jdbcType=VARCHAR},
      details = #{details,jdbcType=VARCHAR},
      file_url = #{fileUrl,jdbcType=VARCHAR},
      feedback = #{feedback,jdbcType=BIT},
      feedback_type = #{feedbackType,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      publisher = #{publisher,jdbcType=VARCHAR},
      is_received = #{isReceived,jdbcType=BIT},
    receive_time = #{receiveTime,jdbcType=TIMESTAMP},
      is_completed = #{isCompleted,jdbcType=BIT},
    complete_time = #{completeTime,jdbcType=TIMESTAMP},
    feedback_content = #{feedbackContent,jdbcType=VARCHAR},
    score = #{score,jdbcType=BIGINT},
    score_result = #{scoreResult,jdbcType=VARCHAR},
    score_username = #{scoreUsername,jdbcType=VARCHAR},
      parent_id = #{parentId,jdbcType=BIGINT},
      is_deleted = #{isDeleted,jdbcType=BIT},
      target_type = #{targetType,jdbcType=BIT}
    where id = #{id,jdbcType=BIGINT}
  </update>


  <!-- 查询总条数 -->
  <select id="countByCondition" parameterType="map" resultType="java.lang.Integer">
    SELECT COUNT(*)
    from sys_task
    <include refid="QUERY_WHERE_PART_CLAUSE"/>
  </select>

  <!-- 分页 -->
  <sql id="QUERY_LIMIT_CONDITION">
    <if test="offset != null  and pageSize != null and pageSize &gt; 0">LIMIT #{offset}, #{pageSize}</if>
  </sql>
  <!-- 查询条件 -->
  <sql id="QUERY_WHERE_PART_CLAUSE">
    <trim prefix="where" prefixOverrides="and | or">
      <if test="id != null" >
        AND id = #{id,jdbcType=BIGINT}
      </if>
      <if test="workType != null" >
        AND work_type = #{workType,jdbcType=VARCHAR}
      </if>
      <if test="leaderId != null" >
        AND leader_id = #{leaderId,jdbcType=BIGINT}
      </if>
      <if test="chejianId != null" >
        AND chejian_id = #{chejianId,jdbcType=BIGINT}
      </if>
      <if test="cheduiId != null" >
        AND chedui_id = #{cheduiId,jdbcType=BIGINT}
      </if>
      <if test="workerId != null" >
        AND worker_id = #{workerId,jdbcType=BIGINT}
      </if>
      <if test="roleType != null" >
        AND role_type = #{roleType,jdbcType=BIT}
      </if>
      <if test="parentId != null" >
        AND parent_id = #{parentId,jdbcType=BIGINT}
      </if>
      <if test="score != null" >
        AND score = #{score,jdbcType=BIGINT}
      </if>
      <if test="scoreResult != null" >
        AND score_result = #{scoreResult,jdbcType=VARCHAR}
      </if>
      <if test="scoreUsername != null" >
        AND score_username = #{scoreUsername,jdbcType=VARCHAR}
      </if>

      <if test="ignoreParentIdNull != null and ignoreParentIdNull==1" >
        AND parent_id >0
      </if>

      <if test="isReceived != null" >
        AND is_received = #{isReceived,jdbcType=BIT}
      </if>
      <if test="isCompleted != null" >
        AND is_completed = #{isCompleted,jdbcType=BIT}
      </if>
      <if test="targetType != null" >
        AND target_type = #{targetType,jdbcType=BIT}
      </if>

      <if test="startTime != null" >
        and create_time <![CDATA[ >= ]]> #{startTime ,jdbcType=TIMESTAMP}

      </if>
      <if test="endTime != null" >
        and create_time <![CDATA[ < ]]> #{endTime ,jdbcType=TIMESTAMP}
      </if>

      <if test="completeState != null and completeState==1" >
        AND is_completed = 2
      </if>
      <if test="completeState != null and completeState==2" >
        <![CDATA[ AND is_completed !=2 ]]>
      </if>
      <if test="completeState != null and completeState==3" >
        AND is_completed = 2 AND is_received=1 AND complete_time >end_time
      </if>
      <if test="completeState != null and completeState==4" >
        <![CDATA[ AND is_completed !=2 AND end_time < NOW()  ]]>
      </if>
    </trim>
  </sql>

  <!-- group by -->
  <sql id="QUERY_GROUPBY_CONDITION">
    <if test="groupByName != null "> <![CDATA[ group by ${groupByName}]]> </if>
  </sql>

  <select id="selectByCondition" parameterType="map" resultMap="BaseResultMap">
    select <include refid="Base_Column_List" />
    from sys_task
    <include refid="QUERY_WHERE_PART_CLAUSE"/>
    <if test="orderColumn != null and orderType != null"><![CDATA[  ORDER BY ${orderColumn}  ${orderType} ]]></if>
    <include refid="QUERY_LIMIT_CONDITION"/>
  </select>

  <delete id="deleteById" parameterType="java.lang.Long">
    delete from sys_task
    where id = #{id}
  </delete>

  <select id="selectByParentIdList" resultMap="BaseResultMap">
    SELECT    <include refid="Base_Column_List"/>
    FROM sys_task
    WHERE parent_id IN (
    <foreach collection="list" item="item" separator=",">
      #{item}
    </foreach>
    )
  </select>

  <delete id="deleteByIdList" >
    DELETE
    FROM sys_task
    WHERE id IN (
    <foreach collection="list" item="item" separator=",">
      #{item}
    </foreach>
    )
  </delete>

  <insert id="batchInsert">
    INSERT INTO sys_task
    (
    <include refid="Base_Column_List_WithOut_Id"/>
    )
    VALUES
    <foreach item="item" open="" close="" separator="," collection="list">
      ( #{item.workType,jdbcType=VARCHAR}, #{item.leaderId,jdbcType=BIGINT},
      #{item.leaderName,jdbcType=VARCHAR}, #{item.chejianId,jdbcType=BIGINT},
      #{item.chejianName,jdbcType=VARCHAR},#{item.cheduiId,jdbcType=BIGINT},
      #{item.cheduiName,jdbcType=VARCHAR},      #{item.workerId,jdbcType=BIGINT},
      #{item.workerName,jdbcType=VARCHAR}, #{item.roleType,jdbcType=BIT},
      #{item.startTime,jdbcType=TIMESTAMP},
      #{item.endTime,jdbcType=TIMESTAMP}, #{item.summary,jdbcType=VARCHAR},
      #{item.details,jdbcType=VARCHAR},
      #{item.fileUrl,jdbcType=VARCHAR}, #{item.feedback,jdbcType=BIT},
      #{item.feedbackType,jdbcType=VARCHAR},#{item.createTime,jdbcType=TIMESTAMP},
      #{item.publisher,jdbcType=VARCHAR}, #{item.isReceived,jdbcType=BIT}, #{item.receiveTime,jdbcType=TIMESTAMP},
      #{item.isCompleted,jdbcType=BIT}, #{item.completeTime,jdbcType=TIMESTAMP},
      #{item.feedbackContent,jdbcType=VARCHAR},
      #{item.score,jdbcType=BIGINT},
      #{item.scoreResult,jdbcType=VARCHAR},
      #{item.scoreUsername,jdbcType=VARCHAR},
      #{item.parentId,jdbcType=BIGINT}, #{item.isDeleted,jdbcType=BIT},
      #{item.targetType,jdbcType=BIT})
    </foreach>
  </insert>



  <resultMap id="StasticsResultMap" type="com.ft.backend.work.client.vo.TaskStasticsVo">
    <id column="targetId" jdbcType="BIGINT" property="targetId" />
    <id column="targetName" jdbcType="VARCHAR" property="targetName" />
    <result column="task_total" jdbcType="INTEGER" property="taskTotal" />
    <result column="complete_total" jdbcType="INTEGER" property="completeTotal" />
  </resultMap>

  <select id="selectTaskStasticsList" parameterType="map" resultMap="StasticsResultMap">
    select
    <if test="staticsType != null and staticsType==1"> chejian_id as targetId,count(id) as task_total </if>
    <if test="staticsType != null and staticsType==2"> chedui_id as targetId,count(id) as task_total </if>
    <if test="staticsType != null and staticsType==3"> worker_id as targetId,count(id) as task_total </if>
    <if test="staticsType != null and staticsType==4"> work_type as targetName,count(id) as task_total </if>
    from sys_task
    <include refid="QUERY_WHERE_PART_CLAUSE"/>
    <include refid="QUERY_GROUPBY_CONDITION"/>
    <if test="orderColumn != null and orderType != null"><![CDATA[  ORDER BY ${orderColumn}  ${orderType} ]]></if>
    <include refid="QUERY_LIMIT_CONDITION"/>
  </select>

  <select id="countTaskStastics" parameterType="map" resultType="java.lang.Integer">
    SELECT  <![CDATA[ count(DISTINCT(    ${groupByName}    ))  ]]>
    from sys_task
    <include refid="QUERY_WHERE_PART_CLAUSE"/>
  </select>


  <resultMap id="TaskScoreResultMap" type="com.ft.backend.work.client.vo.TaskScoreVo">
    <result column="targetId" jdbcType="BIGINT" property="targetId" />
    <result column="targetName" jdbcType="VARCHAR" property="targetName" />
    <result column="score" jdbcType="INTEGER" property="score" />
    <result column="taskTotal" jdbcType="INTEGER" property="taskTotal" />
  </resultMap>
  <select id="selectScoreStasticsList" parameterType="map" resultMap="TaskScoreResultMap">
    select
    <if test="staticsType != null and staticsType==1"> chejian_id as targetId, score as score, count(*) as taskTotal</if>
    <if test="staticsType != null and staticsType==2"> chedui_id as targetId, score as score, count(*) as taskTotal</if>
    <if test="staticsType != null and staticsType==3"> worker_id as targetId, score as score, count(*) as taskTotal</if>
    <if test="staticsType != null and staticsType==4"> work_type as targetName, score as score, count(*) as taskTotal</if>
    from sys_task

    <trim prefix="where" prefixOverrides="and | or">
      <if test="staticsType != null and staticsType ==1 and idList !=null" >
        AND chejian_id in(
        <foreach item="item" open="" close="" separator="," collection="idList">
          #{item}
        </foreach>
        )
      </if>
      <if test="staticsType != null and staticsType ==2 and idList !=null" >
        AND chedui_id in(
        <foreach item="item" open="" close="" separator="," collection="idList">
          #{item}
        </foreach>
        )
      </if>
      <if test="staticsType != null and staticsType ==3 and idList !=null" >
        AND worker_id in(
        <foreach item="item" open="" close="" separator="," collection="idList">
          #{item}
        </foreach>
        )
      </if>
        <if test="staticsType != null and staticsType ==4 and typeList !=null" >
            AND work_type in(
            <foreach item="item" open="" close="" separator="," collection="typeList">
                #{item}
            </foreach>
            )
        </if>
      <if test="1 != null " >
        AND parent_id>0 and score is NOT NULL
      </if>
    </trim>
    <include refid="QUERY_GROUPBY_CONDITION"/>
  </select>



  <!-- 查询总条数 -->
  <select id="countBySubCondition" parameterType="map" resultType="java.lang.Integer">
    SELECT count(*) FROM (
      SELECT DISTINCT(parent_id)
      from sys_task
      <include refid="QUERY_WHERE_PART_CLAUSE_SUB"/>
    ) A;
  </select>

  <!-- 查询条件 -->
  <sql id="QUERY_WHERE_PART_CLAUSE_SUB">
    <trim prefix="where" prefixOverrides="and | or">
      <if test="id != null" >
        AND id = #{id,jdbcType=BIGINT}
      </if>
      <if test="workType != null" >
        AND work_type = #{workType,jdbcType=VARCHAR}
      </if>
      <if test="leaderId != null" >
        AND leader_id = #{leaderId,jdbcType=BIGINT}
      </if>
      <if test="chejianId != null" >
        AND chejian_id = #{chejianId,jdbcType=BIGINT}
      </if>
      <if test="cheduiId != null" >
        AND chedui_id = #{cheduiId,jdbcType=BIGINT}
      </if>
      <if test="workerId != null" >
        AND worker_id = #{workerId,jdbcType=BIGINT}
      </if>
      <if test="roleType != null" >
        AND role_type = #{roleType,jdbcType=BIT}
      </if>
      <if test="parentId != null" >
        AND parent_id = #{parentId,jdbcType=BIGINT}
      </if>
      <if test="score != null" >
        AND score = #{score,jdbcType=BIGINT}
      </if>
      <if test="scoreResult != null" >
        AND score_result = #{scoreResult,jdbcType=VARCHAR}
      </if>
      <if test="scoreUsername != null" >
        AND score_username = #{scoreUsername,jdbcType=VARCHAR}
      </if>

      <if test="ignoreParentIdNull != null and ignoreParentIdNull==1" >
        AND parent_id >0
      </if>

      <if test="isReceived != null" >
        AND is_received = #{isReceived,jdbcType=BIT}
      </if>
      <if test="isCompleted != null" >
        AND is_completed = #{isCompleted,jdbcType=BIT}
      </if>
      <if test="targetType != null" >
        AND target_type = #{targetType,jdbcType=BIT}
      </if>

      <if test="startTime != null" >
        <![CDATA[ and create_time  >=  #{startTime ,jdbcType=TIMESTAMP} ]]>
      </if>
      <if test="endTime != null" >
        <![CDATA[ and create_time  <  #{endTime ,jdbcType=TIMESTAMP}]]>
      </if>

      <if test="undoType != null and undoType==1" >
        AND is_received = 0
      </if>
      <if test="undoType != null and undoType==2" >
        AND is_received=1 AND is_completed  in (0,1)
      </if>
      <if test="undoType != null and undoType==3" >
        AND is_received = 1 AND is_completed=2
      </if>


      <if test="completeState != null and completeState==1" >
        AND is_completed = 2
      </if>
      <if test="completeState != null and completeState==2" >
        <![CDATA[ AND is_completed !=2 ]]>
      </if>
      <if test="completeState != null and completeState==3" >
        AND is_completed = 2 AND is_received=1 AND complete_time >end_time
      </if>
      <if test="completeState != null and completeState==4" >
        <![CDATA[ AND is_completed !=2 AND end_time< NOW()  ]]>
      </if>
    </trim>
  </sql>

  <select id="selectBySubCondition" parameterType="map" resultMap="BaseResultMap">
    select <include refid="Base_Column_List" />
    from sys_task where id in (
      select distinct(parent_id)
      from sys_task
      <include refid="QUERY_WHERE_PART_CLAUSE"/>
    )
    <if test="orderColumn != null and orderType != null"><![CDATA[  ORDER BY ${orderColumn}  ${orderType} ]]></if>
    <include refid="QUERY_LIMIT_CONDITION"/>
  </select>
</mapper>